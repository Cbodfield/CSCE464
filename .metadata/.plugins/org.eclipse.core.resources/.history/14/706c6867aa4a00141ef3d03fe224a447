package classes;

import java.sql.SQLException;
import java.util.ArrayList;
import java.sql.ResultSet;

public class ExecuteDatabaseCall {
	
	//TODO - helper class that dynamically builds up where clause in queries based on parameters passed in
	// this  will allow searching with empty params
	private String buildQuery(String sbQueryBase, ArrayList<String> sFields, ArrayList<Object> oParams){
		StringBuilder sb = new StringBuilder();
		sb.append(sbQueryBase); 		
		
		//add for each in fields
		//iterate through appending non-empty fields
		//need to force user to enter at least 1 criteria on the search page with js
		
		/*	if (!sSource.isEmpty()){
			sb.append(" (SOURCE = ?) ");	
		}

		if (!sDestination.isEmpty()){
			sb.append("AND (DESTINATION = ?) ");
		}*/
		
		return "";
	}
	
	//TODO - not finished - returns 2 dimensional array of objects - like a data table
	public ArrayList<ArrayList<Object>> getSearchResults(String sSource, String sDestination, String sTravelDate, String sNumOfSeats, String sClass){
		JDBCHelper jdbc = new JDBCHelper();
		ArrayList<Object> param =  new ArrayList<Object>();
		ArrayList<ArrayList<Object>> results =  new ArrayList<ArrayList<Object>>();
		ArrayList<String> sFields = new ArrayList<String>();
		ArrayList<Object> oParams = new ArrayList<Object>();
		
		sFields.add("Source");
		sFields.add("Destination");
		sFields.add("Date"); //fix?
		sFields.add("Seats"); //fix?
		sFields.add("Class"); //fix?
		
		oParams.add(sSource);
		oParams.add(sDestination);
		oParams.add(sTravelDate);
		oParams.add(sNumOfSeats);
		oParams.add(sClass);
		
		String sQuery = buildQuery("SELECT * FROM FLIGHTS", null, null);
		
		ResultSet rs1 = jdbc.queryDB(sQuery, param);

		try {
			if (rs1 != null){
				while (rs1.next()){
					ArrayList<Object> temp = new ArrayList<Object>();
					/*TODO - correct db to get date and stops count?*/
					/*TODO - is Class a parameter to the db?*/
					temp.add(rs1.getObject("FLIGHTNUMBER")); //flight number
					temp.add(rs1.getObject("DATE")); //flight date?
					temp.add(rs1.getObject("DEPARTURE")); //departure time, date, or both?
					temp.add(rs1.getObject("ARRIVAL")); //arrival time, date, or both?
					temp.add(rs1.getObject("")); //number of stops
					temp.add(rs1.getObject("COST")); //cost
					
					
					results.add(temp);
				}
			}
			jdbc.closeConnection();
		} catch (SQLException e) {
			e.printStackTrace();
		} 
				
		return results;		
	}
	
}
